<!doctype html>
<html>
    <head>
        <title>STAGES</title>

        <meta charset="UTF-8" />

        <!-- styles -->
        <style type="text/css">
            html, body{
                font-family: Arial;
                font-size: 14px;
            }

            #workflow{
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .stage{
                background: #f0f0f0;
                border: 1px solid #cbcbcb;
                margin: 10px;
                padding: 10px;
                position: relative;
                border-radius: 20px;
                min-height: 100px;
                width: 200px;

                transition: all 200ms ease;
            }

            .stage[data-active="true"]{
                background: #ecffe7;
                border: 1px solid #388c27;
            }

            .stage > p{
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                background: #cbcbcb;
                margin: 0;
                border-radius: 20px 20px 0 0;
                padding: 5px 0 5px 18px;
            }

            .stage > .milestones{
                /* background: lime; */
                position: absolute;
                right: -15px;
                top: 30px;
            }

            .stage > .milestones > .milestone{
                background: #cbcbcb;
                min-width: 20px;
                height: 20px;
                border-radius: 20px;
                margin: 5px;
                padding: 2px;
                font-size: 11px;
                text-align: center;
                line-height: 20px;
            }

            stage > .milestones > .milestone[data-active="true"]{
                background: #ecffe7;
                border: 1px solid #388c27;
            }
        </style>

        <!-- scripts -->
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script>

            function getTestStagesJSON(){
                return {
                    "StartSearching": {
                        "id": "91",
                        "name": "StartSearching",
                        "state": "inactive",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "84",
                                "name": "C4",
                                "state": "inactive",
                                "stage": "StartSearching"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "79",
                                "name": "StartSearchingTask",
                                "state": "inactive",
                                "stage": "StartSearching"
                            }
                        ]
                    },
                    "CountPeople": {
                        "id": "71",
                        "name": "CountPeople",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "78",
                                "name": "C3",
                                "state": "inactive",
                                "stage": "CountPeople"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "88",
                                "name": "CountPeopleTask",
                                "state": "done",
                                "stage": "CountPeople"
                            }
                        ]
                    },
                    "CloseFireDoors": {
                        "id": "73",
                        "name": "CloseFireDoors",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "85",
                                "name": "CX",
                                "state": "inactive",
                                "stage": "CloseFireDoors"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "90",
                                "name": "CloseFireDoorsTask",
                                "state": "done",
                                "stage": "CloseFireDoors"
                            }
                        ]
                    },
                    "CallEmergency": {
                        "id": "77",
                        "name": "CallEmergency",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "95",
                                "name": "C1",
                                "state": "inactive",
                                "stage": "CallEmergency"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "101",
                                "name": "CallEmergencyTask",
                                "state": "done",
                                "stage": "CallEmergency"
                            }
                        ]
                    },
                    "StartEvacuatingPeople": {
                        "id": "74",
                        "name": "StartEvacuatingPeople",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "98",
                                "name": "C2",
                                "state": "inactive",
                                "stage": "StartEvacuatingPeople"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "97",
                                "name": "StartEvacuatingPeopleTask",
                                "state": "done",
                                "stage": "StartEvacuatingPeople"
                            }
                        ]
                    },
                    "StartExtinguishing": {
                        "id": "99",
                        "name": "StartExtinguishing",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "80",
                                "name": "C6",
                                "state": "inactive",
                                "stage": "StartExtinguishing"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "72",
                                "name": "StartExtinguishingTask",
                                "state": "done",
                                "stage": "StartExtinguishing"
                            }
                        ]
                    },
                    "CheckForCompleteness": {
                        "id": "100",
                        "name": "CheckForCompleteness",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "92",
                                "name": "C5",
                                "state": "inactive",
                                "stage": "CheckForCompleteness"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "82",
                                "name": "CheckForCompletenessTask",
                                "state": "done",
                                "stage": "CheckForCompleteness"
                            }
                        ]
                    },
                    "OpenChimney": {
                        "id": "81",
                        "name": "OpenChimney",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "75",
                                "name": "CX",
                                "state": "inactive",
                                "stage": "OpenChimney"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "96",
                                "name": "OpenChimneyTask",
                                "state": "done",
                                "stage": "OpenChimney"
                            }
                        ]
                    },
                    "ActivateSiren": {
                        "id": "87",
                        "name": "ActivateSiren",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "76",
                                "name": "CX",
                                "state": "inactive",
                                "stage": "ActivateSiren"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "93",
                                "name": "ActivateSirenTask",
                                "state": "done",
                                "stage": "ActivateSiren"
                            }
                        ]
                    },
                    "SayItsDone": {
                        "id": "86",
                        "name": "SayItsDone",
                        "state": "active",
                        "guards": null,
                        "milestones": [
                            {
                                "id": "94",
                                "name": "CX",
                                "state": "inactive",
                                "stage": "SayItsDone"
                            }
                        ],
                        "tasks": [
                            {
                                "id": "83",
                                "name": "SayItsDoneTask",
                                "state": "done",
                                "stage": "SayItsDone"
                            }
                        ]
                    }
                };
            }

            function loadStages(){

                //$.get('stages/stages.json').done(function(jsonStr){

                    //var stages = JSON.parse(jsonStr);
                    var stages = getTestStagesJSON();
                    console.log('STAGES: ', stages);

                    for(var i in stages){
                        var stage = stages[i];
                        buildStage(stage);
                    }

                //});


            }

            $(document).ready(function(){
                loadStages();
            });

            function buildStage(stage){
                var $wf = $('#workflow');

                var $stage = $('<div class="stage"></div>')
                    .attr('data-name', stage.name)
                    .attr('data-id', stage.id)
                    .attr('data-active', stage.state == 'active' ? 'true' : 'false')
                    .appendTo($wf);



                $('<p></p>').text(stage.name).appendTo($stage);

                $('<div class="milestones"></div>').appendTo($stage);

                for(var i in stage.milestones){
                    var milestone = stage.milestones[i];
                    buildMilestone(stage, milestone);
                    buildMilestone(stage, milestone);
                    buildMilestone(stage, milestone);
                }
            }

            function buildMilestone(stage, milestone){

                var $stage = $('.stage[data-id="'+stage.id+'"]');
                var $milestones = $stage.children('.milestones').eq(0);
               

                $('<div class="milestone"></div>')
                    .text(milestone.name)
                    .attr('data-active', milestone.state == 'active' ? 'true' : 'false')
                    .appendTo($milestones);

            }

            function buildTask(stage, task){

            }

        </script>
    </head>
    <body>

        <div id="workflow"></div>
       
    </body>
</html>